# 模型特定速率限制功能说明

## 功能概述

新增了对特定模型的速率限制功能，允许管理员为不同用户分组设置针对特定模型的请求限制。

## 新格式说明

### 支持的JSON格式

#### 1. 新格式（推荐）
```json
{
  "default": {
    "total_count": 200,
    "success_count": 100,
    "models": ["gemini-2.5-pro", "gemini-2.5-flash"]
  },
  "vip": {
    "total_count": 0,
    "success_count": 1000
  }
}
```

#### 2. 旧格式（兼容）
```json
{
  "default": [200, 100],
  "vip": [0, 1000]
}
```

## 字段说明

- `total_count`: 最多请求次数（包括失败请求），0表示不限制
- `success_count`: 最多请求完成次数（只包括成功请求），必须大于等于1
- `models`: 模型列表（可选字段）
  - 如果不填写或为空数组，则限制所有模型
  - 如果填写了模型列表，则只限制指定的模型

## 使用示例

### 示例1：限制default用户组对特定模型的访问
```json
{
  "default": {
    "total_count": 100,
    "success_count": 50,
    "models": ["gemini-2.5-pro", "gemini-2.5-flash"]
  }
}
```
这表示default用户组在设置的周期内，对gemini-2.5-pro和gemini-2.5-flash模型最多请求100次，成功完成50次。

### 示例2：限制所有模型
```json
{
  "default": {
    "total_count": 200,
    "success_count": 100
  }
}
```
这表示default用户组在设置的周期内，对所有模型最多请求200次，成功完成100次。

### 示例3：混合配置
```json
{
  "default": {
    "total_count": 100,
    "success_count": 50,
    "models": ["gemini-2.5-pro"]
  },
  "vip": {
    "total_count": 0,
    "success_count": 1000
  }
}
```

## 优先级说明

1. 模型特定限制 > 分组一般限制 > 全局限制
2. 如果用户组对特定模型有配置，则使用该配置
3. 如果用户组对特定模型没有配置，但有分组一般限制，则使用分组一般限制
4. 如果都没有配置，则使用全局限制

## 技术实现

### 后端修改
- `setting/rate_limit.go`: 新增数据结构支持模型特定限制
- `middleware/model-rate-limit.go`: 修改中间件支持模型特定的限流key

### 前端修改
- `web/src/pages/Setting/RateLimit/SettingsRequestRateLimit.js`: 更新UI支持新格式
- `i18n/zh-cn.json`: 更新国际化文本

## 兼容性

- 完全向后兼容旧格式
- 旧格式会自动转换为新格式
- 不影响现有配置

## 注意事项

1. 模型名称必须与实际的模型名称完全匹配
2. 限制周期统一使用全局配置的"限制周期"值
3. Redis和内存模式都支持新功能
4. 每个模型的限制是独立的，不会相互影响
